version: 0.2

phases:
  install:
    runtime-versions:
      java: corretto11
  build:
    commands:
      - | 
          STACK_STATUS=$(aws cloudformation describe-stacks --stack-name wow-api-stack 2> /dev/null | jq .Stacks | jq .[0] | jq .StackStatus | xargs) 
          echo $STACK_STATUS
          if [ "ROLLBACK_COMPLETE" == "${STACK_STATUS}" ]; then
            echo stack is in ROLLBACK_COMPLETE delete it
            aws cloudformation delete-stack --stack-name wow-api-stack
            aws cloudformation wait stack-delete-complete --stack-name wow-api-stack
          else
            echo do somthing else
          fi
          aws cloudformation create-stack --stack-name wow-api-stack --template-body file://seededjob1.yaml
